<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/~martinjkellogg.com/teaching/cs684-sp24/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/~martinjkellogg.com/teaching/cs684-sp24/assets/css/just-the-docs-default.css"> <script src="/~martinjkellogg.com/teaching/cs684-sp24/assets/js/vendor/lunr.min.js"></script> <script src="/~martinjkellogg.com/teaching/cs684-sp24/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Homework 3: Fuzzing with AFL | CS 684 (Sp24)</title><meta name="generator" content="Jekyll v3.9.2" /><meta property="og:title" content="Homework 3: Fuzzing with AFL" /><meta name="author" content="Martin Kellogg" /><meta property="og:locale" content="en_US" /><meta name="description" content="The course website for NJIT CS 684 in Fall 2024" /><meta property="og:description" content="The course website for NJIT CS 684 in Fall 2024" /><link rel="canonical" href="https://web.njit.edu//~martinjkellogg.com/teaching/cs684-sp24/projects/hw3.html" /><meta property="og:url" content="https://web.njit.edu//~martinjkellogg.com/teaching/cs684-sp24/projects/hw3.html" /><meta property="og:site_name" content="CS 684 (Sp24)" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Homework 3: Fuzzing with AFL" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Martin Kellogg"},"description":"The course website for NJIT CS 684 in Fall 2024","headline":"Homework 3: Fuzzing with AFL","url":"https://web.njit.edu//~martinjkellogg.com/teaching/cs684-sp24/projects/hw3.html"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/~martinjkellogg.com/teaching/cs684-sp24/" class="site-title lh-tight"> CS 684 (Sp24) </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Homeworks category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/" class="nav-list-link">Homeworks</a><ul class="nav-list "><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw0.html" class="nav-list-link">Homework 0: Setup</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw1.html" class="nav-list-link">Homework 1: Coverage Warmup</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw2.html" class="nav-list-link">Homework 2: Coverage</a><li class="nav-list-item active"><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw3.html" class="nav-list-link active">Homework 3: Fuzzing with AFL</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw4.html" class="nav-list-link">Homework 4: Generating Tests with EvoSuite</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw5.html" class="nav-list-link">Homework 5: Invariants and Partial Oracles</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw6.html" class="nav-list-link">Homework 6: Mutation Testing</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw7.html" class="nav-list-link">Homework 7: Static Analysis with Infer</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw8.html" class="nav-list-link">Homework 8: Abstract Interpretation Design</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw9.html" class="nav-list-link">Homework 9: Abstract Interpretation Implementation</a><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/hw10.html" class="nav-list-link">Homework 10: Formal Methods with Z3</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Tutorials category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/~martinjkellogg.com/teaching/cs684-sp24/tutorials/" class="nav-list-link">Tutorials</a><ul class="nav-list "><li class="nav-list-item "><a href="/~martinjkellogg.com/teaching/cs684-sp24/tutorials/reading-papers.html" class="nav-list-link">How to Read a Paper</a></ul><li class="nav-list-item"><a href="/~martinjkellogg.com/teaching/cs684-sp24/calendar/" class="nav-list-link">Calendar</a><li class="nav-list-item"><a href="/~martinjkellogg.com/teaching/cs684-sp24/exam/" class="nav-list-link">Exams</a><li class="nav-list-item"><a href="/~martinjkellogg.com/teaching/cs684-sp24/staff/" class="nav-list-link">Staff</a><li class="nav-list-item"><a href="/~martinjkellogg.com/teaching/cs684-sp24/about/" class="nav-list-link">Syllabus</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search CS 684 (Sp24)" aria-label="Search CS 684 (Sp24)" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://njit.instructure.com/courses/32931" class="site-button" > Canvas </a><li class="aux-nav-list-item"> <a href="https://discord.com/channels/1197590679623315466" class="site-button" > Discord </a><li class="aux-nav-list-item"> <a href="https://www.gradescope.com/courses/695850" class="site-button" > Gradescope </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/~martinjkellogg.com/teaching/cs684-sp24/projects/">Homeworks</a><li class="breadcrumb-nav-list-item"><span>Homework 3: Fuzzing with AFL</span></ol></nav><div id="main-content" class="main-content" role="main"><h2 class="fs-6" id="homework-3-fuzzing-with-afl"> <a href="#homework-3-fuzzing-with-afl" class="anchor-heading" aria-labelledby="homework-3-fuzzing-with-afl"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Homework 3: Fuzzing with AFL <strong class="label label-red">Due Wednesday, February 14, 2024, 11:59PM AoE</strong></h2><p>In this assignment you will use tools to automatically create a high-coverage test suite for a program.</p><p>You <em>may</em> work with a partner for this assignment.</p><h3 id="start-early"> <a href="#start-early" class="anchor-heading" aria-labelledby="start-early"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Start Early</h3><p>Professors often exhort students to start assignments early. Many students wait until the night before and then complete the assignments anyway. Students thus learn to ignore “start early” suggestions. This is <strong>not</strong> that sort of suggestion.</p><details> <summary> Warning: the tools take hours! </summary><p>The tools you must use for this assignment <strong>literally</strong> take <strong>multiple hours</strong> to run. Some students reported that it took over 14 hours to run! (However, others were able to finish in about five minutes. Regardless of when you finish, everything is fine.) Even if you are fast and can finish your work at the last minute, the tools are not and can not. On a high-powered multi-core rack-mounted RAID-storage test machine it took 6.3 hours to run the AFL tool. However, as soon as you get enough data (see below) you can stop early (just press Ctrl-C).</p></details><p>However, once running, the tools are completely automated. Thus, you can start them running overnight, sleep and ignore them, and wake up to results. This means that even though the assignment may not take hours of your active personal attention, you must start it days before the due date to be able to complete it in time.</p><details> <summary>Installing, Compiling and Running Legacy Code</summary><p>It is <strong>your responsibility</strong> to download, compile, and run the subject programs in this assignment (and the other assignments in this course). Getting the code to work is <strong>part of the assignment</strong>. You can post on the forum for help and compare notes bemoaning various architectures (e.g., windows vs. mac vs. linux, etc.). Ultimately, however, it is your responsibility to read the documentation for these programs and utilities and use some elbow grease to make them work.</p></details><h3 id="subject-program-and-tool-png-graphics-c--american-fuzzy-lop"> <a href="#subject-program-and-tool-png-graphics-c--american-fuzzy-lop" class="anchor-heading" aria-labelledby="subject-program-and-tool-png-graphics-c--american-fuzzy-lop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Subject Program and Tool: PNG Graphics (C) + American Fuzzy Lop</h3><p>The first subject program is <code class="language-plaintext highlighter-rouge">libpng</code>’s <code class="language-plaintext highlighter-rouge">pngtest</code> program, seen earlier in Homework 2. This reuse has two advantages. First, since you are already familiar with the program, it should not take long to get started. Second, you will be able to compare the test cases produced by the black-box tool to the white-box test cases you made manually. (You’ll have to recompile it with special flags, but it’s the same source code.)</p><p>The associated test input generation tool is <a href="https://en.wikipedia.org/wiki/American_fuzzy_lop_(fuzzer)">American fuzzy lop</a> (hereafter “AFL”), version 2.52b. A mirror copy of the AFL tarball is <a href="../assets/afl-2.5.2b.tgz">here</a>, but you should visit the <a href="http://lcamtuf.coredump.cx/afl/">project webpage</a> for documentation. As the (punny? bunny?) name suggests, it is a <a href="https://en.wikipedia.org/wiki/Fuzzing">fuzz testing tool</a>.</p><p>You will use AFL to create a test suite of <code class="language-plaintext highlighter-rouge">.png</code> images to exercise the <code class="language-plaintext highlighter-rouge">pngtest</code> program, starting from all of the <code class="language-plaintext highlighter-rouge">.png</code> images provided with the original tarball. Note that you can terminate AFL as soon as you reach 510 <code class="language-plaintext highlighter-rouge">paths_total</code> (also called total paths in the GUI)— AFL does not stop on its own (instead, press Ctrl-C to stop it).</p><h3 id="afl-installation-and-use-details"> <a href="#afl-installation-and-use-details" class="anchor-heading" aria-labelledby="afl-installation-and-use-details"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> AFL installation and use details</h3><p>AFL claims that one of its key advantages is ease of use. We will consider four separate high-level steps in this dynamic analysis.</p><h4 id="step-1-compile-afl"> <a href="#step-1-compile-afl" class="anchor-heading" aria-labelledby="step-1-compile-afl"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Compile AFL</h4><p>Follow along with AFL’s <a href="http://lcamtuf.coredump.cx/afl/QuickStartGuide.txt">quick start guide</a>. Extract the AFL tarball (to its own directory) and run “make”.</p><p>Note that this results in files such as <code class="language-plaintext highlighter-rouge">afl-gcc</code> and <code class="language-plaintext highlighter-rouge">afl-fuzz</code>, which we will use in subsequent steps.</p><h4 id="step-2-instrument-libpng"> <a href="#step-2-instrument-libpng" class="anchor-heading" aria-labelledby="step-2-instrument-libpng"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: ‘Instrument’ libpng</h4><p>Do <em>not</em> re-use your HW2 copy of libpng. (It is possible, but leads to much confusion.) Instead, download a fresh copy of the reference implementation (version 1.6.40) <a href="../assets/libpng-1.6.40.tar.gz">here</a> and place it in a new folder for Homework 3 (e.g., HW3).</p><p>Change to that <code class="language-plaintext highlighter-rouge">libpng-1.6.40</code> directory and re-configure <code class="language-plaintext highlighter-rouge">libpng</code> with a special configure line like this:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ CC=/REPLACE/THIS/TEXT/WITH/YOUR/PARTICULAR/PATH/TO/afl-gcc_(don't_just_copy_this_in_unchanged) ./configure --disable-shared CFLAGS="-static" 
$ make 
</code></pre></div></div><p>The “CC” bit will look something like (but maybe different for you) <code class="language-plaintext highlighter-rouge">CC=/home/ubuntu/cs684/hw3/afl-2.52b/afl-gcc</code> — note that there is no trailing slash. If you see <code class="language-plaintext highlighter-rouge">configure: error: C compiler cannot create executables</code>, double-check your spelling here. Also, folder names with spaces (like “CS 684/HW 3”) will not work: rename the folder to remove the spaces.</p><p>Multiple students have reported that WSL does not work with AFL and that they needed to move to an Ubuntu virtual machine instead (as per HW0). See the FAQ below.</p><p>Note that you are not using “coverage” or <code class="language-plaintext highlighter-rouge">gcov</code> for this part of the homework assignment. We only want AFL instrumentation for now.</p><h4 id="step-3--choosing-seed-images"> <a href="#step-3--choosing-seed-images" class="anchor-heading" aria-labelledby="step-3--choosing-seed-images"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3 — Choosing seed images</h4><p>AFL uses initial inputs you provide and mutates them to find new inputs that cover additional parts of the program. (For more information, see its documentation.) The initial inputs you provide are called seed inputs. Since we are testing libpng, the seed inputs are “images”.</p><p>Because AFL repeatedly processes these seed files, if you include very large or very many seed files, AFL will take too long to run.</p><p>Make a new subdirectory to hold your seed files. This subdirectory may be called <code class="language-plaintext highlighter-rouge">testcase_dir</code> in the documentation, but you can name it whatever you want. Most students put their 50 manual test cases from HW2 there, but if your HW2 images are large, consider only including the smaller ones. (You’ll want to know the total coverage of the seed images you start with for the HW3 written report, but since you’ve left your HW2 installation alone, you can compute that using the same method you used in HW2. Delete the old coverage information in your HW2 folder, run pngtest on all of your seed images, and run <code class="language-plaintext highlighter-rouge">gcov</code> to list the total coverage.)</p><h4 id="step-4--afl-generates-inputs-for-libpng"> <a href="#step-4--afl-generates-inputs-for-libpng" class="anchor-heading" aria-labelledby="step-4--afl-generates-inputs-for-libpng"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4 — AFL generates inputs for libpng</h4><p>Now it is time to run AFL on libpng.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo su
# echo core &gt; /proc/sys/kernel/core_pattern
# exit
$ /REPLACE/THIS/TEXT/WITH/YOUR/path/to/afl-fuzz -i testcase_dir -o findings_dir -- /path/to/pngtest_(not_.c_nor_.png_but_the_executable_you_built) @@
</code></pre></div></div><p>(In this command, the <code class="language-plaintext highlighter-rouge">/path/to/pngtest_(not_.c_nor_.png_but_the_executable_you_built)</code> part is the absolute path to the <code class="language-plaintext highlighter-rouge">pngtest</code> executable that is created after running <code class="language-plaintext highlighter-rouge">make</code> in the <code class="language-plaintext highlighter-rouge">libpng</code> directory for HW3 in Step 2 above. For example, it might potentially look something like <code class="language-plaintext highlighter-rouge">/home/ubuntu/HW3/libpng-1.6.40/pngtest</code> but might be slightly different for you.)</p><p>Do double-check the end of the previous line for <code class="language-plaintext highlighter-rouge">@@</code>. It is <em>required</em>, it is <strong>not a typo</strong>, and if you did not type it in (to tell AFL where its randomly-created arguments to <code class="language-plaintext highlighter-rouge">pngtest</code> go) you are likely to “get stuck” when enumerating paths and tests (see FAQ below).</p><p>Note that <code class="language-plaintext highlighter-rouge">findings_dir</code> is a new folder you make up: <code class="language-plaintext highlighter-rouge">afl-fuzz</code> will put its results there (in a <code class="language-plaintext highlighter-rouge">queue</code> subfolder). The results will be “images” (both good and bad) produced by AFL to get high coverage. The results will all have ugly names, but they will be the output of AFL.</p><p>Note that <em>you must stop afl-fuzz yourself</em> (just press Ctrl-C), otherwise it will run forever — it does not stop on its own. Read the Report instructions below for information on the stopping condition and knowing “when you are done”.</p><p>Note also that you can <em>resume</em> afl-fuzz if it is interrupted or stopped in the middle (you don’t “lose your work”). When you try to re-run it, it will give you a helpful message like:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>To resume the old session, put '-' as the input directory in the command
line ('-i -') and try again.
</code></pre></div></div><p>Just follow its directions. <strong>Warning:</strong> when you resume AFL it will <em>overwrite</em> your <code class="language-plaintext highlighter-rouge">findings/plot_data</code> file (which you need for the final report), so be sure to save a copy of that somewhere before resuming.</p><p>Note that <code class="language-plaintext highlighter-rouge">afl-fuzz</code> may abort the first few times you run it and ask you to change some system settings (e.g., <code class="language-plaintext highlighter-rouge">echo core | sudo tee /proc/sys/kernel/core_pattern</code>, <code class="language-plaintext highlighter-rouge">echo core &gt;/proc/sys/kernel/core_pattern</code> etc.). For example, on Ubuntu systems it often asks twice. Just become root and execute the commands. Note that <code class="language-plaintext highlighter-rouge">sudo</code> may not work for some of the commands (e.g., <code class="language-plaintext highlighter-rouge">sudo echo core &gt;/proc/sys/kernel/core_pattern</code> will fail because bash will do the <code class="language-plaintext highlighter-rouge">&gt;</code> redirection before running <code class="language-plaintext highlighter-rouge">sudo</code> so you will not yet have permissions, etc.) — so just become root (e.g., run <code class="language-plaintext highlighter-rouge">sudo sh</code>) and then execute the commands in a root shell. If you are getting <code class="language-plaintext highlighter-rouge">core_pattern: Permission denied</code> errors, make sure you become root first before executing the commands:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo su
echo core &gt; /proc/sys/kernel/core_pattern
exit
</code></pre></div></div><p>The produced test cases are in the <code class="language-plaintext highlighter-rouge">findings_dir/queue/</code> directory. They may not have the <code class="language-plaintext highlighter-rouge">.png</code> extension (instead, they might have names like <code class="language-plaintext highlighter-rouge">000154,sr...pos/36,+cov</code>), but you can rename them if you like. Note that AFL can and will produce “invalid” PNG files to test error handling code; such “invalid” PNG files will appear to produce errors or otherwise not be viewable. This is normal and expected.</p><p>At some point, many students are tempted to ask a question like “Is it normal that my XYZ Machine got to ABC paths in PQR minutes?” We acknowledge that students are often anxious about this assignment. For many students, this may be a first experience using an off-the-shelf tool with an unknown running time. As a software engineer, you will need to be comfortable with <em>scheduling</em> and <em>risk</em> (especially with respect to schedules). Part of this homework is designed to give you a feeling for what it is like to employ a software engineering process in the face of <em>uncertainty</em>. We want to give you experience with this in a safe (classroom) setting, rather than having your first experience with this be on the job. Regretfully, there is no way for us to answer questions about whether or not it is normal that your particular machine took some particular time. I know students really wish we could reduce their anxiety or uncertainty about this process. In practice, the running time of AFL depends on many factors, including the side and number of the seed images, the speed of your CPU and disk, the load on the machine, and so on. There is no secret formula for how long it is supposed to take that we are hiding from you but will reveal if you ask such a question directly. Instead, living with this uncertainty — feeling uncomfortable about it, and having to complete the assignment anyway — is a key point of the assignment.</p><details> <summary>Help! I can't open AFL's output!</summary><p>You will almost certainly find that AFL’s output queue folder does not contain files with the <code class="language-plaintext highlighter-rouge">.png</code> extension. In addition, you will almost certainly find that most of the files produced by AFL are “invalid” PNG files that cause program executions to cover error cases (e.g., <code class="language-plaintext highlighter-rouge">libpng read error</code>).</p><p>This is <strong>normal</strong>.</p><p>Double-check all of the instructions here, and the explanations in the course lectures for how these tools work: there’s no need to panic. In addition, you might try alternate image viewers (rather than just the default one). For example, multiple students have reported that uploading apparently-invalid images to GitHub (no, really) works well for viewing them.</p></details><p>While AFL is running, you can read the <a href="http://lcamtuf.coredump.cx/afl/technical_details.txt">technical whitepaper</a> to learn about how it works and compare the techniques it uses to the basic theory discussed in class.</p><details> <summary>Help! It looks like AFL has stalled! Is that normal? I am worried.</summary><p>Students are often worried that AFL appears to have stalled. Such students often wonder things like: “Should I restart AFL? Or is everything fine? Have I done something wrong? Or should I just leave it be?”</p><p>Making scheduling decisions in the face of uncertainty (i.e., unknown information) is a major theme in the course. It is explicitly part of the assignment.</p><p>Once a student has AFL running correctly (e.g., following the instructions above, not forgetting the @@, etc.) and has seen AFL produce some new images (e.g., by inspecting the output directory from another shell terminal window), that student should feel confident allowing AFL to continue to run. It is very common for AFL to “plateau” or “get stuck” for a while and recover naturally.</p><p>To reassure students, below is a cropped example plot from a previous semester (with the x-axis label intentionally removed). (If your plot does not have this shape, you are still fine.) Note how there are multiple periods where no new progress appears to be made.</p><p><img src="../assets/cropped-afl-plot-example.png" alt="" /></p><p>Students who find that AFL is taking too long also have the option of restarting with a smaller set of seed images, all of which are quite small. The running time of AFL strongly depends on the number and size of your seed images.</p><p>Students are often tempted to ask the course staff questions akin to “Should I allow AFL to continue to run?” Unfortunately, we really don’t have any special information in such circumstances (cf. “Should I continue to wait on the waiting list?”). You must decide for yourself.</p></details> <details> <summary>Help! It looks like AFL's generated test images don't improve coverage (much)!</summary><p>Some students report that the AFL-generated test inputs do not seem to be improving branch coverage with respect to the seed images. This can definitely happen, but usually it means that the student is making a slight typo or similar mistake in the coverage computation.</p><p>In previous semesters, the most common mistakes included:</p><ul><li>Not considering overlap. If your seed images (alone) get 10% coverage and the AFL-generated images (alone) get 11% coverage, it may be that putting them all together gets 15% coverage (or whatnot).<li>Using the wrong pngtest. The AFL-instrumented pngtest binary is not the same as the gcov-instrumented pngtest binary (even though they have the same filename) and will not generated gcov coverage information.<li>Running gcov-instrumented pngtest in the wrong directory.<li>Forgetting to remove gcov intermediate files between runs.</ul><p>To test their coverage process, students might take 15 of their files from HW2 and put them in a directory A. Then copy 1 of those files from A and also put it in directory B. Compute the coverage of the 15 files in A first. Then compute the coverage of the 1 file in B. The coverage of B should be less than A (which should also be less than HW2).</p><p>AFL is not always a useful tool in all contexts. Many students find that “AFL-Generated + Seed” improves on “Seed” by two or three percentage points, but that is not universal, and if you get a different results you are <em>fine</em>. Your answer will vary based on how long you let AFL explore and the initial quality of your seed images.</p></details><h3 id="submission-written-report"> <a href="#submission-written-report" class="anchor-heading" aria-labelledby="submission-written-report"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Submission: Written Report</h3><p>You must create a written PDF report reflecting on your experiences with automatic test generation. You must include your name and NJIT email id (as well as your partner’s name and email id, if applicable). In particular (rubric notes are in []s):</p><ol><li>In a few sentences, your report should describe one test case that AFL created that covered part of <code class="language-plaintext highlighter-rouge">libpng</code> that your manual test suite from Homework 2 did not, and vice versa. (If no such tests exist, for example because you seeded AFL with all of your manual tests, instead describe what did happen. For example, if you seeded AFL with all of your manual tests, then AFL’s output will be a superset of yours.) You should also indicate how many tests your run of AFL created, your total runtime, and the final coverage of the AFL-created test suite (use the technique described in Homework 2 to compute coverage; note that AFL will include all of the original seed tests as well — yes, you should include or consider those). (Optional hint: when comparing two test suites, it sometimes clarifies things to report their two coverages separately and also the coverage obtained when putting them together. Two test suites that each get 10% coverage alone may get 10%, 15% or 20% coverage when combined depending on overlap. Did the “AFL+Seed” combined test suite yield higher coverage then just the Seed images test suite?) [2 points for AFL, 2 points for manual, 1 point for summary]<ul><li>Some students are uncertain about what it means to “describe” an image. This report is being read by a human, and the focus is on testing (not “artistry”). It may serve as helpful framing to imagine that you are writing this report to your boss at a company. The ultimate goal would be to determine if or under what circumstances AFL should be used. While some visual descriptions may be relevant, many find that the properties of the generated files also merit a mention.<li>Some students report being uncertain about how to determine the coverage of a test suite. We recommend that you use the techniques you learned in HW2, such as gcov, to compute coverage. The assignments in this course often build upon each other.</ul><li>Your report should include, as inlined images, one or two “interesting” valid PNG files that AFL created and a one-sentence explanation of why they are “interesting”. [1 point for image(s), 1 point for explanation]<ul><li>Some students report difficulties in uploading certain images to Google Docs. One workaround is to load the image in another viewer, take a screenshot, and upload the screenshot to Google Docs.</ul><li><p>Your report should include a scatterplot in which the x axis is “seconds” (or some other notion of total execution time, such as <code class="language-plaintext highlighter-rouge">unix_time</code>) and the y axis is <code class="language-plaintext highlighter-rouge">paths_total</code> as reported in the <code class="language-plaintext highlighter-rouge">findings/plot_data</code> CSV file produced by your run of AFL. You must create this plot yourself (using the program of your choice; I recommend <code class="language-plaintext highlighter-rouge">gnuplot</code> or a spreadsheet program like Excel or Google Sheets, but whatever you are comfortable with is <em>fine</em>. In a real engineering job, your manager won’t care how you generate plots, as long as they are pretty and contain the required information.). Your scatterplot must include data reaching at least 510 <code class="language-plaintext highlighter-rouge">paths_total</code> on the y axis — which means you must run AFL until you have at least that much data. (See <a href="http://lcamtuf.coredump.cx/afl/plot/">here</a> for plot examples that include much more detail than you are asked to include here. Note that this is <em>not</em> <code class="language-plaintext highlighter-rouge">own finds</code> but is instead <code class="language-plaintext highlighter-rouge">total paths</code> in the upper right corner. Include a sentence that draws a conclusion from this scatterplot. If you do not like scatterplots you can make a line graph (etc.) as long as it conveys the same information. [2 points for plot, 1 point for conclusion]</p><p>Note that it does not matter how many rows are in your <code class="language-plaintext highlighter-rouge">plot_data</code> file or if you are missing some rows at the start or middle as long as you got up to 510 <code class="language-plaintext highlighter-rouge">paths_total</code> (also called “paths total” in the GUI)— it is common to have fewer than 510 rows.</p><p>Note that if you suspended <code class="language-plaintext highlighter-rouge">afl-fuzz</code> you may have a big time gap in your plot. We do not care how you handle that (e.g., ugly graph, big gap, fudge the times, whatever) — any approach is full credit.</p><li><p>In one paragraph, your report should compare and contrast your observations (e.g., usability, efficacy, test quality) of AFL. List at least one strength of AFL and at least one area for improvement. Which software engineering projects might benefit from the use of such a tool? Would you use it personally? Why or why not? [1 point for strengths and weaknesses, 2 points for insightful analysis]</p><li>Although we do not have explicit formatting guidelines that we require you to follow, is is easier for the graders to interpret text that is presented clearly. We encourage you to format your results in a manner that you think would simplify reading later. (One way to double-check would be to write your report draft and then step back for a few minutes and then re-read the text or have your partner re-read the text.) [2 points for clear presentation and no typos that hinder understanding]</ol><p>This does not have to be a formal report; you need only answer the questions in the rubric. However, nothing bad happens if you include extra formality (e.g., sections, topic sentences, etc.).</p><p>There is no explicit format (e.g., for headings or citations) required. For example, you may either use an essay structure or a point-by-point list of question answers.</p><p>The grading staff will select a small number of excerpts from particularly high-quality or instructive reports and share them with the class. If your report is selected you will receive extra credit.</p><p>For this assignment the written report is the primary artifact. There are no programmatic artifacts to submit (however, you will need to run the tools to create the required information for the report). (If you are working with a partner, you must select your partner on Canvas and submit one copy of the report. However, nothing fatal happens if you mistakenly submit two copies.)</p><h3 id="commentary"> <a href="#commentary" class="anchor-heading" aria-labelledby="commentary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Commentary</h3><p>This assignment is perhaps a bit different than the usual CS homework assignment: instead of you, yourself, doing the “main activity” (i.e., creating test suites), you are asked to invoke tools that carry out that activity for you. This sort of automation (from testing to refactoring to documentation, etc.) is indicative of modern industrial software engineering.</p><p>Asking you to submit the generated tests is, in some sense, uninteresting (e.g., we could rerun the tool on the grading server if we just wanted tool-generated tests). Instead, you are asked to write a report that includes information and components that you will only have if you used the tools to generate the tests. Writing reports (e.g., for consumption by your manager or team) is also a common activity in modern industrial software engineering.</p><h3 id="faq-and-troubleshooting"> <a href="#faq-and-troubleshooting" class="anchor-heading" aria-labelledby="faq-and-troubleshooting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> FAQ and Troubleshooting</h3><p>In this section we detail previous student issues and resolutions:</p><ol><li><strong>Question</strong>: Using AFL, I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ERROR: PROGRAM ABORT : Test case 'xxxxxx/pngtest' is too big (2.25 MB, limit is 1.00 MB)
</code></pre></div></div><p><strong>Answer</strong>: You are mistakenly passing the pngtest executable in as a testcase to itself. Try putting your pngtest executable one directory above from your testcase_dir. In other words, rather than having it in the same folder as your test images (testcase_dir), put it in the directory that testcase_dir is in, and adjust /path/to/pngtest accordingly.</p><li><p><strong>Question</strong>: My AFL session has 0 <code class="language-plaintext highlighter-rouge">cycles done</code> but the <code class="language-plaintext highlighter-rouge">total paths</code> counter does increment. I am worried.</p><p><strong>Answer</strong>: Everything is fine. It is entirely possible to complete the assignment with 0 <code class="language-plaintext highlighter-rouge">cycles done</code>. (AFL can enumerate quite a few candidate test cases — enough for this assignment — before doing a complete cycle.)</p><li><p><strong>Question</strong>: My ssh sessions keep getting disconnected. How can I avoid losing my work from a long-running job?</p><p><strong>Answer</strong>: Two common approaches are to use the <a href="https://en.wikipedia.org/wiki/Nohup">nohup</a> command or the <a href="https://en.wikipedia.org/wiki/GNU_Screen">screen</a> command. There are a number of <a href="https://www.tecmint.com/keep-remote-ssh-sessions-running-after-disconnection/">helpful tutorials online</a> to get you started.</p><li><strong>Question</strong>: Using AFL, I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [-]  SYSTEM ERROR : Unable to create './findings_dir/queue/id:000000,orig:pngbar.png'
</code></pre></div></div><p><strong>Answer</strong>: This is apparently a <a href="https://groups.google.com/forum/#!topic/afl-users/oJUGxCUg4Vo">WSL issue</a>, but students running Linux who ran into it were able to fix things by making a new, fresh VM.</p><li><strong>Question</strong>: Using AFL, I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [-] PROGRAM ABORT : Program 'pngtest' not found or not executable
</code></pre></div></div><p>or</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [-] PROGRAM ABORT : Program 'pngnow.png' is not an ELF binary
</code></pre></div></div><p><strong>Answer</strong>: You need to use the right <code class="language-plaintext highlighter-rouge">/path/to/pngtest</code> instead of just <code class="language-plaintext highlighter-rouge">pngtest</code>. You must point to the <code class="language-plaintext highlighter-rouge">pngtest</code> executable (produced by “make”) and not, for example, <code class="language-plaintext highlighter-rouge">pngtest.png</code>.</p><li><strong>Question</strong>: Using AFL, I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[-] PROGRAM ABORT: Program 'pngtest' is a shell script 
</code></pre></div></div><p><strong>Answer</strong>: You must recompile <code class="language-plaintext highlighter-rouge">libpng</code> carefully following the instructions above, including the explanation about “CC=…” and “–disable-shared” and the like. Example showing that a normal build produces a shell script while a more careful AFL-based build produces an executable:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./configure &gt;&amp; /dev/null ; make clean &gt;&amp; /dev/null ; make &gt;&amp; /dev/null ; file ./pngtest

./pngtest: Bourne-Again shell script, ASCII text executable


$ CC=~/481/afl-2.52b/afl-gcc ./configure --disable-shared CFLAGS="-static" &gt;&amp; /dev/null ; make clean &gt;&amp; /dev/null ; make &gt;&amp; /dev/null ; file ./pngtest

./pngtest: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=bec3dc8e4b3feff6660f9339368f5c1ec5f55ab9, with debug_info, not stripped
</code></pre></div></div><li><strong>Question</strong>: When I try to run AFL, I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[-] PROGRAM ABORT : No instrumentation detected
</code></pre></div></div><p><strong>Answer</strong>: You are pointing AFL to the wrong <code class="language-plaintext highlighter-rouge">pngtest</code> executable. Double-check the instructions near <code class="language-plaintext highlighter-rouge">$ CC=/path/to/afl-gcc ./configure --disable-shared CFLAGS="-static"</code>, rebuild <code class="language-plaintext highlighter-rouge">pngtest</code> using “make”, and then point to exactly that executable and not a different one.</p><li><strong>Question</strong>: When I try to run configure with AFL via something like <code class="language-plaintext highlighter-rouge">CC=/home/vagrant/cs684/hw3/afl-2.52b/afl-gcc/ ./configure --disable-shared CFLAGS="-static"</code>, I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> checking whether the C compiler works... no
 configure: error: in `/home/vagrant/cs684/hw3/libpng-1.6.40':
 configure: error: C compiler cannot create executables
</code></pre></div></div><p><strong>Answer</strong>: You need to specify <code class="language-plaintext highlighter-rouge">afl-gcc</code>, not <code class="language-plaintext highlighter-rouge">afl-gcc.c</code> or <code class="language-plaintext highlighter-rouge">afl-gcc/</code> (note trailing slash!).</p><li><p><strong>Question</strong>: When I am running AFL, it gets “stuck” at 163 (or 72, or another small number) paths.</p><p><strong>Answer</strong>: In multiple instances, students had forgotten the @@ at the end of the AFL command. Double check the command you are running!</p><li><strong>Question</strong>: When trying to use AFL on Amazon EC2, I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ec2-user@ip-172-31-19-147 afl-2.52b]$ make

[*] Checking for the ability to compile x86 code...

/bin/sh: cc: command not found



Oops, looks like your compiler can't generate x86 code.
</code></pre></div></div><p><strong>Answer</strong>: One student reported resolving this via <code class="language-plaintext highlighter-rouge">sudo yum groupinstall "Development Tools"</code></p><li><strong>Question</strong>: When I try to compile <code class="language-plaintext highlighter-rouge">libpng</code> with AFL, I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>configure: error: C compiler cannot create executables
</code></pre></div></div><p><strong>Answer</strong>: You need to provide the full path to the <code class="language-plaintext highlighter-rouge">afl-gcc</code> executable, not just the path to <code class="language-plaintext highlighter-rouge">hw3/afl-2.52b/</code>.</p><li><strong>Question</strong>: When running AFL, I receive this error:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SYSTEM ERROR : Unable to create './findings_dir/queue/id:000000,orig:pngbar.png'
</code></pre></div></div><p><strong>Answer</strong>: One student reported that this happens when you try to use a shared folder in the VM to store your HW3 (or AFL) directory. The solution that worked for the student was to move the HW3 directory out of the shared folder.</p><li><p><strong>Question</strong>: Some of the so-called “png” files that AFL produces cannot be opened by my image viewer and may not even be valid “png” files at all!</p><p><strong>Answer</strong>: Yes, you are correct. (Thought question: why are invalid inputs sometimes good test cases for branch coverage?)</p><li><p><strong>Question</strong>: What does “interesting” mean for the report? Similarly, how should we “elaborate” or “reflect”?</p><p><strong>Answer</strong>: We sympathize with students who are concerned that their grades may not reflect their mastery of the material. Being conscientious is a good trait for CS in general and SE in particular. However, this is not a calculus class. Software engineering involves judgment calls. I am not asking you to compute the derivatives of various polynomials (for which there is one known right answer). You are carrying out activities that are indicative of SE practices.</p><p>Suppose you are tasked with evaluating a test generation tool for your company. You are asked to do a pilot study evaluating such a tool and prepare a report for your boss. One of the things the boss wants to know is: “What are the risks associated with using such a tool?” Similarly for the benefits or rewards.</p><li><p><strong>Question</strong>: Can I use free cloud computing, like Amazon EC2, for this assignment?</p><p><strong>Answer</strong>: Sure - we recommend it! Here’s what one student had to say:</p><blockquote><p>If you can get over the hump of setting up AWS (pro-tip they have lots of documentation, use google. also <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html">here you go</a>), their free-tier EC2 instances can get the AFL job done in a blink. Using their free-tier EC2 Ubuntu instance, I was able to run AFL up to &gt;500 paths in 5 minutes. Setup would probably take less than 30 minutes for a new user. IMO that more than balances the headache of having to run AFL for hours and hours and hours and hours.</p></blockquote><li><strong>Question</strong>: I am using WSL, and when I try to run AFL I get:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ CC=/mnt/c/users/.../684/hw3/afl-2.52b/afl-gcc ./configure --disable-shared CFLAGS="static"
checking for a BSD-compatible install... 
/usr/bin/install: setting permissions for '/mnt/c/users/.../hw3/libpng-1.6.40/conftest.dir/conftest.one': Operation not permitted
...
configure: error: in `/mnt/c/users/.../684/hw3/libpng-1.6.40':
configure: error: C compiler cannot create executables
</code></pre></div></div><p><strong>Answer</strong>: Students were able to resolve this by not using WSL and instead using an Ubuntu virtual machine.</p><li><p><strong>Question</strong>: How can I make AFL run faster?</p><p><strong>Question</strong>: I’m getting “The program took more than 1000 ms to process” warnings from AFL.</p><p><strong>Answer</strong>: One anonymous student suggests:</p><blockquote><p>Is your AFL running slow? Are you getting less than 30/sec on the exec speed? Have you been running for 21+ hours like me and are frustrated that you haven’t found any new paths in the last 4 hours?</p></blockquote><blockquote><p>Try making a copy of your test image directory, then remove any “large” test images from this new directory (I deleted all test images over 100KB), and then try running a new AFL session with this new input directory, and a new output directory. Each “session” of AFL basically runs in a single thread, so it seems to be fine running two different sessions at once, with different input/output directories. I watched as my new run (with small test image files) consistently ran with an exec speed of 500-1000, and achieved 600 total paths in under 7 minutes, all while safely letting my old session continue to run.</p></blockquote><blockquote><p>tl;dr Don’t use lots of “large” images with AFL (large roughly being &gt;100KB)</p></blockquote><li><p><strong>Question</strong>: When I try to compile libpng using the AFL compiler, I get an error like the following: <code class="language-plaintext highlighter-rouge">C compiler cannot create executables</code>.</p><p><strong>Answer</strong>: Make sure you have the libraries you need to compile libpng. You may want to refer back to the <a href="./hw2.html">HW2 instructions</a>.</p></ol><hr><footer><p class="text-small text-grey-dk-100 mb-0">&copy; 2022-2024 Martin Kellogg, Westley Weimer, René Just, Jonathan Bell, Adeel Bhutta and Mitch Wand. Released under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a> license</p></footer></div></div><div class="search-overlay"></div></div>
