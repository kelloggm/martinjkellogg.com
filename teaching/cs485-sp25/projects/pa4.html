<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/martinjkellogg.com/teaching/cs485-sp25/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/martinjkellogg.com/teaching/cs485-sp25/assets/css/just-the-docs-default.css"> <script src="/martinjkellogg.com/teaching/cs485-sp25/assets/js/vendor/lunr.min.js"></script> <script src="/martinjkellogg.com/teaching/cs485-sp25/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>PA4: Optimizer | CS 485 Compilers (Sp25)</title><meta name="generator" content="Jekyll v3.9.2" /><meta property="og:title" content="PA4: Optimizer" /><meta name="author" content="Martin Kellogg" /><meta property="og:locale" content="en_US" /><meta name="description" content="The course website for NJIT CS 485 in Spring 2025, as taught by Martin Kellogg" /><meta property="og:description" content="The course website for NJIT CS 485 in Spring 2025, as taught by Martin Kellogg" /><link rel="canonical" href="https://kelloggm.github.io/martinjkellogg.com/teaching/cs485-sp25/projects/pa4.html" /><meta property="og:url" content="https://kelloggm.github.io/martinjkellogg.com/teaching/cs485-sp25/projects/pa4.html" /><meta property="og:site_name" content="CS 485 Compilers (Sp25)" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PA4: Optimizer" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Martin Kellogg"},"description":"The course website for NJIT CS 485 in Spring 2025, as taught by Martin Kellogg","headline":"PA4: Optimizer","url":"https://kelloggm.github.io/martinjkellogg.com/teaching/cs485-sp25/projects/pa4.html"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/martinjkellogg.com/teaching/cs485-sp25/" class="site-title lh-tight"> CS 485 Compilers (Sp25) </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Programming Assignments category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/" class="nav-list-link">Programming Assignments</a><ul class="nav-list "><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/pa1.html" class="nav-list-link">PA1: Rosetta Stone</a><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/pa2.html" class="nav-list-link">PA2: Semantic Analyzer</a><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/pa3.html" class="nav-list-link">PA3: Code Generator</a><li class="nav-list-item active"><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/pa4.html" class="nav-list-link active">PA4: Optimizer</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Tutorials category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/martinjkellogg.com/teaching/cs485-sp25/tutorials/" class="nav-list-link">Tutorials</a><ul class="nav-list "><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/tutorials/reading-papers.html" class="nav-list-link">How to Read a Paper (Useful for "Optional" Readings)</a><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/tutorials/ubuntu.html" class="nav-list-link">Ubuntu Setup Guide</a></ul><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/calendar/" class="nav-list-link">Calendar</a><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/exam/" class="nav-list-link">Exams</a><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/staff/" class="nav-list-link">Staff</a><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/languages/" class="nav-list-link">Supported Languages</a><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/about/" class="nav-list-link">Syllabus</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search CS 485 Compilers (Sp25)" aria-label="Search CS 485 Compilers (Sp25)" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://kelloggm.github.io/martinjkellogg.com/teaching/cs485-sp25/crm/onepage/crm-onepage.html" class="site-button" > CRM </a><li class="aux-nav-list-item"> <a href="https://discord.com/channels/1329854456967467048/1329854456967467051" class="site-button" > Discord </a><li class="aux-nav-list-item"> <a href="https://www.gradescope.com/courses/956674" class="site-button" > Gradescope </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/">Programming Assignments</a><li class="breadcrumb-nav-list-item"><span>PA4: Optimizer</span></ol></nav><div id="main-content" class="main-content" role="main"><h2 class="fs-6" id="pa4-optimizer"> <a href="#pa4-optimizer" class="anchor-heading" aria-labelledby="pa4-optimizer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PA4: Optimizer <strong class="label label-red">Due Day of Your Final Exam, 2025, 11:59PM AoE.</strong></h2><p><strong>This page is still under construction: check back for more details later.</strong></p><p>You are advised to complete this assignment in the same language you used for PA3. Your starter code for this assignment is typically your final PA3 submission. You are permitted to, but strongly discouraged from, starting over without using your PA3 submission. If you plan to do so, you should discuss the situation with the instructor and/or TAs first.</p><p>You may work in a team of two people for this assignment if and only if you worked in a team for PA3 and both teammates are still willing to work together. If either teammate does not want to work together anymore, both of you <em>must</em> work alone (but you may each start from a copy of the shared PA3 starter code). The course staff are not responsible for finding you a willing teammate. You are always permitted to work alone, if you choose.</p><h3 id="goal"> <a href="#goal" class="anchor-heading" aria-labelledby="goal"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Goal</h3><p>For this assignment you will write an <em>optimizing</em> code generator. This typically involves transforming the abstract syntax tree into a control-flow graph of three-address code and applying a number of dataflow analyses and optimizations. In addition, students typically apply pattern-matching optimizations at the AST level and peephole optimizations at the assembly level.</p><p>In all cases, the optimized assembly code you emit must produce <strong>exactly the same</strong> result as the reference compiler. The first rule of optimization is “don’t break the program”.</p><p>You do not have to worry about “malformed source code” because the semantic analyzer (from PA2) has already ruled out bad programs.</p><p>This assignment is an explicit competition. You will receive more credit if your optimizer is “better” than that of other students in terms of the number of machine cycles that your generated assembly code takes to execute various test programs.</p><h3 id="summary-of-checkpoints"> <a href="#summary-of-checkpoints" class="anchor-heading" aria-labelledby="summary-of-checkpoints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary of Checkpoints</h3><p>There is one checkpoint for the Optimizer:</p><ul><li><strong>PA4c1</strong> requires you to implement a dead-code eliminator for Cool three-address code (i.e., the same format as PA3c2). This dead-code eliminator need not be part of the same codebase as the rest of PA4 – the specification for it (see below) is standalone. However, your final PA4 submission is required to include a dead-code eliminator, so we strongly suggest that you integrate PA4c1 into your existing codebase. For example, you might have a command-line switch in your main codebase that makes it match the PA4c1 specification, which you enable by default when submitting PA4c1. This checkpoint is due on <strong>Monday, April 28</strong>.<li><strong>PA4 (full)</strong> will be evaluated on the day of the final exam. You will automatically make a submission to PA4 when you submit PA3 (i.e., we will add your PA3 submission to the leaderboard). You can continue to make changes to your optimizer and resubmit it as many times as you’d like between the PA3 and PA4 deadlines.</ul><h3 id="pa4c1-dead-code-elimination"> <a href="#pa4c1-dead-code-elimination" class="anchor-heading" aria-labelledby="pa4c1-dead-code-elimination"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PA4c1: Dead Code Elimination</h3><p>PA4c1 is a stand-alone checkpoint assignment designed to encourage you to write a <a href="http://en.wikipedia.org/wiki/Dead_code_elimination">dead-code eliminator</a> for <a href="../pa3.html#pa3c2-three-address-code-generator">Cool three-address code</a>. Since your final PA4 submission is <em>required</em> to include a dead-code eliminator, we encourage you to use this checkpoint as an excuse to implement one. However, if it would be more convenient for your compiler’s design to do dead-code elimination on another IR, you <em>can</em> skip this checkpoint (but we don’t recommend it, and it will cost you a few points). Come talk to the course staff if you’re unsure.</p><p>For this checkpoint, your dead-code eliminator should implement a “global” <a href="https://en.wikipedia.org/wiki/Live-variable_analysis">live-variable analysis</a> (like the one discussed in class); recall that “global”, in the context of optimization, means “considers a single method at once.”</p><h4 id="specification"> <a href="#specification" class="anchor-heading" aria-labelledby="specification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Specification</h4><p>You should submit a program that takes a single command-line argument (e.g., <code class="language-plaintext highlighter-rouge">file.cl-tac</code>). That argument will be an ASCII text Cool Three Address Code file (as described in the PA3c2 specification) corresponding to a single method. The cl-tac file will always be well-formed (i.e., there will be no errors in the cl-tac file). Your program must output a revised, valid .cl-tac file to standard output. The output should be the same as the input but with dead code removed. Your program will consist of a number of source files, all in the same programming language. We suggest (but do not require) that it be a variant of your main PA3/PA4 codebase; we would implement this specification by setting a flag in our compiler’s codebase.</p><h4 id="dead-code-elimination"> <a href="#dead-code-elimination" class="anchor-heading" aria-labelledby="dead-code-elimination"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dead Code Elimination</h4><p>A variable is <strong>live</strong> if it may be needed in the future. That is, an assignment to variable <em>v</em> at point <em>p</em> is live if there exists a path from <em>p</em> to the function exit along which <em>v</em> is read before it is overwritten.</p><p>For example, consider the following TAC:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a &lt;- int 1
b &lt;- int 3
c &lt;- + a b 
d &lt;- int 7
retval &lt;- call out_int c 
return retval 
</code></pre></div></div><p>On the fourth line, the assignment to <em>d</em> is dead because <em>d</em> is not subsequently used. Dead assignments can be removed. Often eliminating one piece of dead code can reveal additional dead code. For example, consider this fragment of TAC:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a &lt;- int 1
b &lt;- int 3
c &lt;- + a b 
d &lt;- int 7
e &lt;- + d d 
retval &lt;- call out_int c 
return retval 
</code></pre></div></div><p>In above example, the assignment to <em>d</em> is <strong>not</strong> dead (yet!) but the assignment to <em>e</em> is dead. Once the assignment to <em>e</em> is eliminated, the assignment to <em>d</em> becomes dead and can then be eliminated. Thus, live variable analysis and dead code elimination must be repeated until nothing further changes.</p><p>You should use the <a href="http://en.wikipedia.org/wiki/Live_variable_analysis">live variable analysis</a> form of <a href="http://en.wikipedia.org/wiki/Data-flow_analysis">data-flow analysis</a> to determine which assignments are dead code. We discussed this topic in class (in the “Global Optimization” and “Dead Code Elimination” lectures), but you are not required to follow the lecture slides’ formalism: you may use any of the (many) equivalent analyses described online, in the textbook, etc - as long as you preserve the program’s semantics and remove dead code.</p><p>Note that function calls with I/O side effects should never be eliminated.</p><h4 id="basic-blocks-and-control-flow-graphs"> <a href="#basic-blocks-and-control-flow-graphs" class="anchor-heading" aria-labelledby="basic-blocks-and-control-flow-graphs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Blocks and Control-Flow Graphs</h4><p>A <a href="http://en.wikipedia.org/wiki/Basic_block">basic block</a> is a sequence of instructions with only one control-flow entry and one control-flow exit. That is, once you start executing the instructions in a basic block, you must execute all of them — you cannot jump out early or jump in half-way through.</p><p>A <em>local</em> dataflow analysis operates on basic blocks. As part of this checkpoint, you will need to implement a local dead-code eliminator.</p><p>As part of this assignment you will also implement a <em>global</em> dataflow analysis that operates on multiple basic blocks (that together form one entire method). A <a href="http://en.wikipedia.org/wiki/Control_flow_graph">control-flow graph</a> is a graph in which the nodes are basic blocks and the edges represent potential control flow.</p><p>You are not required to use these formalisms, exactly, in the your implementation. However, we <em>strongly</em> suggest that you explicitly represent the basic blocks and control-flow graph of the input TAC program.</p><h4 id="commentary"> <a href="#commentary" class="anchor-heading" aria-labelledby="commentary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Commentary</h4><p>A successful implementation of this checkpoint will have the following stages:</p><ol><li>Deserialize the input .cl-tac file<li>Identify basic blocks and construct the control-flow graph<li>Repeat until nothing changes:<ol><li>Perform global live variable analysis on the control-flow graph<ul><li>This involves local live variable analysis on individual statements or basic blocks</ul><li>Eliminate dead code</ol><li>Serialize the result to standard output in .cl-tac format</ol><p>You can do basic testing as follows:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cool --tac file.cl --out original
$ cool --tac --opt file.cl --out ref_optimized
$ my-dce original.cl-tac &gt; my_optimized.cl-tac
$ cool ref_optimized.cl-tac &gt; optimized.output
$ cool my_optimized.cl-tac &gt; my.output
$ diff optimized.output my.output
$ cool --profile ref_optimized.cl-tac | grep STEPS
$ cool --profile my_optimized.cl-tac | grep STEPS
</code></pre></div></div><p>Passing <code class="language-plaintext highlighter-rouge">--opt</code> and <code class="language-plaintext highlighter-rouge">--tac</code> to the reference compiler will cause the reference compiler to perform dead code elimination before emitting the .cl-tac file.</p><h4 id="scoring"> <a href="#scoring" class="anchor-heading" aria-labelledby="scoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scoring</h4><p>There are fifteen test cases for PA4c1 (they are the same test cases, in the same order, that were used for PA3c3). We will run each with 10 inputs. You <em>lose</em> one-tenth of a point for each input for which you do not produce the correct output, to a miniumum of zero. You gain one-tenth of a point for each test input for which your generated cl-tac, when simulated, executes fewer instructions than a threshold chosen by the course staff. Your score is rounded down to the nearest integer.</p><h3 id="pa4-full-the-optimizer"> <a href="#pa4-full-the-optimizer" class="anchor-heading" aria-labelledby="pa4-full-the-optimizer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PA4 (full): the Optimizer</h3><p>More details coming soon!</p><hr><footer><p class="text-small text-grey-dk-100 mb-0">&copy; 2022-2025 Martin Kellogg, Wes Weimer, Jonathan Bell, Adeel Bhutta and Mitch Wand. Released under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a> license</p></footer></div></div><div class="search-overlay"></div></div>
