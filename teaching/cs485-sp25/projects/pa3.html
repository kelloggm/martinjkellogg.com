<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/martinjkellogg.com/teaching/cs485-sp25/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/martinjkellogg.com/teaching/cs485-sp25/assets/css/just-the-docs-default.css"> <script src="/martinjkellogg.com/teaching/cs485-sp25/assets/js/vendor/lunr.min.js"></script> <script src="/martinjkellogg.com/teaching/cs485-sp25/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>PA3: Code Generator | CS 485 Compilers (Sp25)</title><meta name="generator" content="Jekyll v3.9.2" /><meta property="og:title" content="PA3: Code Generator" /><meta name="author" content="Martin Kellogg" /><meta property="og:locale" content="en_US" /><meta name="description" content="The course website for NJIT CS 485 in Spring 2025, as taught by Martin Kellogg" /><meta property="og:description" content="The course website for NJIT CS 485 in Spring 2025, as taught by Martin Kellogg" /><link rel="canonical" href="https://kelloggm.github.io/martinjkellogg.com/teaching/cs485-sp25/projects/pa3.html" /><meta property="og:url" content="https://kelloggm.github.io/martinjkellogg.com/teaching/cs485-sp25/projects/pa3.html" /><meta property="og:site_name" content="CS 485 Compilers (Sp25)" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PA3: Code Generator" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Martin Kellogg"},"description":"The course website for NJIT CS 485 in Spring 2025, as taught by Martin Kellogg","headline":"PA3: Code Generator","url":"https://kelloggm.github.io/martinjkellogg.com/teaching/cs485-sp25/projects/pa3.html"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/martinjkellogg.com/teaching/cs485-sp25/" class="site-title lh-tight"> CS 485 Compilers (Sp25) </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Programming Assignments category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/" class="nav-list-link">Programming Assignments</a><ul class="nav-list "><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/pa1.html" class="nav-list-link">PA1: Rosetta Stone</a><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/pa2.html" class="nav-list-link">PA2: Semantic Analyzer</a><li class="nav-list-item active"><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/pa3.html" class="nav-list-link active">PA3: Code Generator</a><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/pa4.html" class="nav-list-link">PA4: Optimizer</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Tutorials category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/martinjkellogg.com/teaching/cs485-sp25/tutorials/" class="nav-list-link">Tutorials</a><ul class="nav-list "><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/tutorials/reading-papers.html" class="nav-list-link">How to Read a Paper (Useful for "Optional" Readings)</a><li class="nav-list-item "><a href="/martinjkellogg.com/teaching/cs485-sp25/tutorials/ubuntu.html" class="nav-list-link">Ubuntu Setup Guide</a></ul><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/calendar/" class="nav-list-link">Calendar</a><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/exam/" class="nav-list-link">Exams</a><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/staff/" class="nav-list-link">Staff</a><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/languages/" class="nav-list-link">Supported Languages</a><li class="nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/about/" class="nav-list-link">Syllabus</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search CS 485 Compilers (Sp25)" aria-label="Search CS 485 Compilers (Sp25)" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://kelloggm.github.io/martinjkellogg.com/teaching/cs485-sp25/crm/onepage/crm-onepage.html" class="site-button" > CRM </a><li class="aux-nav-list-item"> <a href="https://discord.com/channels/1329854456967467048/1329854456967467051" class="site-button" > Discord </a><li class="aux-nav-list-item"> <a href="https://www.gradescope.com/courses/956674" class="site-button" > Gradescope </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/martinjkellogg.com/teaching/cs485-sp25/projects/">Programming Assignments</a><li class="breadcrumb-nav-list-item"><span>PA3: Code Generator</span></ol></nav><div id="main-content" class="main-content" role="main"><h2 class="fs-6" id="pa3-code-generator"> <a href="#pa3-code-generator" class="anchor-heading" aria-labelledby="pa3-code-generator"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PA3: Code Generator <strong class="label label-red">Due Monday, 7 April 2025, 11:59PM AoE.</strong></h2><p><strong>This page is still under construction: check back for more details later.</strong></p><p>You may complete this assignment in any language listed on the <a href="../languages/">languages page</a> in buckets 1, 2, or 3. You are required to complete this assignment and PA4 in the same language (you are expected to modify you PA3 assignment for PA4).</p><p>You may work in a team of two people for this assignment. If you worked with a teammate on PA2, you do not need to work with the same teammate for this assignment. You do not need to keep the same teammate between this assignment and PA4, but if you choose not to work with your PA3 teammate again on PA4, you <em>must</em> work alone on PA4. The course staff are not responsible for finding you a willing teammate. You are always permitted to work alone, if you choose.</p><h3 id="goal"> <a href="#goal" class="anchor-heading" aria-labelledby="goal"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Goal</h3><p>For this assignment you will write a code generator. Among other things, this involves implementing the operational semantics specification of Cool. You will track enough information to generate legitimate run-time errors (e.g., dispatch on void). You do not have to worry about “malformed input” because the semantic analyzer (from PA2) has already ruled out bad programs. You will also write additional code to unserialize the class map, implementation map, parent map, and annotated AST produced by the semantic analyzer.</p><h3 id="summary-of-checkpoints"> <a href="#summary-of-checkpoints" class="anchor-heading" aria-labelledby="summary-of-checkpoints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary of Checkpoints</h3><p>You need to make four submissions for this assignment:</p><ul><li><strong>PA3c1</strong> requires you to write test cases (i.e., Cool programs) that find injected bugs in our reference compiler. This checkpoint ensures that you have a robust test suite for your own compiler before you begin implementing it in earnest. This checkpoint is relatively straightforward (you just need to write small Cool programs), so it due early: on <strong>Friday, March 7</strong>.<li><strong>PA3c2</strong> requires you to produce a simple intermediate representation for (some) Cool programs (“three-address code” (TAC), which we’ll discuss in class). While it’s up to you how much you want to use TAC for the rest of PA3, we think it’s a useful intermediate representation, and we want to force you to make some progress early. And, it’s hard to break the compiler up into sensible chunks, so this is the best that we can do. Since producing TAC is pretty straightforward compared to the rest of the compiler implementation, this checkpoint is due relatively quickly after PA3c1: on <strong>Friday, March 14</strong>.<li><strong>PA3c3</strong> requires that your compiler generates assembly instructions for certain simple Cool programs. This is harder than it sounds: once you have this part working, getting to the full compiler is usually easier than getting to this point. For that reason, we give you a few weeks to make it to this point: it is due on <strong>Monday, March 31</strong>.<li><strong>PA3 (full)</strong> requires that your compiler handle all of Cool. It is due on <strong>Monday, April 7</strong>.</ul><h3 id="specification"> <a href="#specification" class="anchor-heading" aria-labelledby="specification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Specification</h3><p>You must create three artifacts:</p><ol><li>A program that takes a single command-line argument (e.g., <code class="language-plaintext highlighter-rouge">file.cl-type</code>). That argument will be an ASCII text Cool class map, implementation map, parent map and annotated AST file (as described in PA2). Your program must emit x86-64 Assembly Language (<code class="language-plaintext highlighter-rouge">file.s</code>). Your program will consist of a number of source files in a single language.<ul><li>Compiling <code class="language-plaintext highlighter-rouge">file.s</code> with <code class="language-plaintext highlighter-rouge">gcc -no-pie -static</code> on a 64-bit x86 Linux system (specifically, Ubuntu 22.04) must produce an executable that, when run, produces the correct output for <code class="language-plaintext highlighter-rouge">file.cl</code> according to Cool’s operational semantics.</ul><ul><li>You will only be given <code class="language-plaintext highlighter-rouge">.cl-type</code> files from programs that pass the semantic analysis phase of the reference compiler. You are not responsible for correctly handling <code class="language-plaintext highlighter-rouge">(1+"hello")</code> programs.</ul><li>A plain ASCII text file called <code class="language-plaintext highlighter-rouge">readme.txt</code> describing your design decisions and choice of test cases. See the grading rubric. A few paragraphs should suffice.<li>Testcases <code class="language-plaintext highlighter-rouge">test1.cl</code>, <code class="language-plaintext highlighter-rouge">test2.cl</code>, <code class="language-plaintext highlighter-rouge">test3.cl</code> and <code class="language-plaintext highlighter-rouge">test4.cl</code>. The testcases should exercise compiler and run-time error corner cases. See the description of PA3c1, below.</ol><h4 id="error-reporting"> <a href="#error-reporting" class="anchor-heading" aria-labelledby="error-reporting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Reporting</h4><p>You are guaranteed that the <code class="language-plaintext highlighter-rouge">file.cl-type</code> input file will be correctly formed and will correspond to a well-typed Cool program. Thus, there will not be any direct static errors in the input. Those were all caught by the semantic analyzer earlier.</p><p>However, you must generate <code class="language-plaintext highlighter-rouge">file.s</code> so that it checks for and reports run-time errors. When your <code class="language-plaintext highlighter-rouge">file.s</code> program detects an error, it should use Cool’s built-ins (e.g., <code class="language-plaintext highlighter-rouge">IO.out_string</code>)via assembly instructions to cause an error string to be printed to the screen.</p><p>To report an error, write the string <code class="language-plaintext highlighter-rouge">ERROR:</code> <em>line_number</em><code class="language-plaintext highlighter-rouge">: Exception:</code> <em>message</em> and terminate the program. You may generate your <code class="language-plaintext highlighter-rouge">file.s</code> so that it writes whatever you want in the message, but it should be fairly indicative. Example erroneous input:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Main inherits IO {
  my_void_io : IO ; -- no initializer =&gt; void value
  main() : Object {
    my_void_io.out_string("Hello, world.\n")
  } ;
} ;
</code></pre></div></div><p>For such an input, you must generate a well-formed <code class="language-plaintext highlighter-rouge">file.s</code> assmebly language file. However, when that file is executed on an x86-64 machine, it will produce output such as:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR: 4: Exception: dispatch on void
</code></pre></div></div><p>To put this another way, rather than actually checking for errors directly, you must <em>generate assembly code</em> that will later check for and report errors. You probably want to examine how the reference compiler does this to get an idea of what to do.</p><h4 id="line-numbers-for-error-reporting"> <a href="#line-numbers-for-error-reporting" class="anchor-heading" aria-labelledby="line-numbers-for-error-reporting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Line Numbers for Error Reporting</h4><p>The typing rules do not directly specify the line numbers on which errors are to be reported. As of v1.36, the Cool reference compiler uses these guidelines:</p><ul><li>Stack overflow: undefined (not your responsibility)<li>Division by zero: location of the division expression<li>Substring out of range: location of the internal expression (i.e., 0)<li>Dispatch on void: location of dispatch expression<li>case-related errors: location of case expression</ul><p>Note that the reference <em>interpreter</em> uses different line numbers in some cases; you must match the reference <em>compiler</em> (which you invoke by passing the <code class="language-plaintext highlighter-rouge">--x86</code> argument to <code class="language-plaintext highlighter-rouge">cool</code>).</p><h4 id="commentary"> <a href="#commentary" class="anchor-heading" aria-labelledby="commentary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Commentary</h4><p>You will have to handle all of the <em>internal</em> functions (e.g., <code class="language-plaintext highlighter-rouge">IO.out_string</code>) that are defined in the Cool Reference Manual.</p><p>You can do basic testing as follows:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cool --x86 file.cl-type
gcc -no-pie -static file.s
./a.out &amp;&gt; reference-output
my-code-generator file.cl-type
gcc -no-pie -static file.s
./a.out &amp;&gt; my-output
diff my-output reference-output
</code></pre></div></div><p>Whitespace and newlines do not matter in your <code class="language-plaintext highlighter-rouge">file.s</code> assembly code. However, <strong>whitespace and newlines do matter</strong> for the <em>output</em> of your assembly code. This is because you are specifically being asked to implement IO and string functions.</p><p>You should implement all of the <a href="../crm/modern/Operational%20Semantics.html">operational semantics rules in the Reference Manual</a>. You will also have to implement all of the built-in functions on the <a href="../crm/modern/Basic%20Classes.html">five Basic Classes</a>.</p><hr><footer><p class="text-small text-grey-dk-100 mb-0">&copy; 2022-2025 Martin Kellogg, Wes Weimer, Jonathan Bell, Adeel Bhutta and Mitch Wand. Released under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a> license</p></footer></div></div><div class="search-overlay"></div></div>
